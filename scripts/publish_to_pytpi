#!/usr/bin/env bash


echo -e "\n0. All below"
echo -e "1. Sovrin"
echo -e "2. Plenum"
echo -e "3. Ledger"
echo -e "4. Anoncreds"

echo -e "\nEnter comma separated numbers for repos you want to upload to pypi (for example: 1,2):"
IFS=',' read repos

if [ $repos -eq "0" ]; then
    repos="1,2,3,4"
fi;

read -p "Selected repos: $repos, continue: (Y/n)? " cont

if [ $cont != "Y" ];then
    exit
fi;

curDir=`pwd`
scriptDir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
echo -e "Current script directory: $scriptDir"
cd $scriptDir
cd ../..
allRepoParentDir=`pwd`

for repo in $(echo $repos | sed "s/,/ /g")
do
    cd $allRepoParentDir

    repoName=""
    if [ $repo -eq "1" ]; then
        repoName="sovrin-priv"
    elif [ $repo -eq "2" ]; then
        repoName="plenum-priv"
    elif [ $repo -eq 3 ]; then
        repoName="ledger-priv"
    elif [ $repo -eq 4 ]; then
        repoName="anoncreds-priv"
    else
        echo -e "Not supported this repo $repo"
        exit
    fi
    cd $repoName
    cdir=`pwd`
    echo -e "\n\nabout to start uploading $repoName to pypi... [cur dir: $cdir]"

    mv setup.py setup-st.py
    mv setup-dev.py setup.py

    python setup.py register -r pypitest
    python setup.py sdist upload -r pypitest

    python setup.py register -r pypi
    python setup.py sdist upload -r pypi

    mv setup.py setup-dev.py
    mv setup-st.py setup.py

    echo -e "finished uploading $repoName to pypi\n"
done

cd $curDir